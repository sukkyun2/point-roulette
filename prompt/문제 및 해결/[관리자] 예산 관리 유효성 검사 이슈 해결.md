# 예산 관리자 버그 해결

```sql
╭───────────────────────────────────────────────────╮
│ ✻ Welcome to Claude Code!                         │
│                                                   │
│   /help for help, /status for your current setup  │
│                                                   │
│   cwd: /Users/goobg/Desktop/point-roulette        │
╰───────────────────────────────────────────────────╯

> @api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetValidator.kt를 구현해줘
  createvalidator, udpatevalidator로 나뉘고 실패시 @api/src/main/kotlin/org/example/roulette/api/common/app/ValidationException.kt을 throw해

  create와 update에     private fun validateBudgetDate(budgetDate: LocalDate) {
          require(!budgetDate.isBefore(LocalDate.now())) {
              "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다"
          }
      }

      private fun validateBudgetAmount(totalBudget: Long) {
          require(totalBudget > 0) {
              "예산은 0보다 커야 합니다"
          }
      } 프라이빗 메서드로 정의되어있는 것들을 여기로 옮겨
  ⎿  Read api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetValidator.kt (3 lines)
  ⎿  Read api/src/main/kotlin/org/example/roulette/api/common/app/ValidationException.kt (6 lines)
  ⎿  ⧉ Selected 11 lines from api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt in IntelliJ IDEA

⏺ Read(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Read 60 lines (ctrl+r to expand)
  ⎿  api/CLAUDE.md

⏺ Write(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetValidator.kt)
  ⎿  User rejected update to api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetValidator.kt
        5    import java.time.LocalDate
        6    
        7    @Component
        8 -  class RouletteBudgetCreateValidator {
        9 -      companion object {
       10 -          private const val INVALID_BUDGET_DATE_MESSAGE = "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다"
       11 -          private const val INVALID_BUDGET_AMOUNT_MESSAGE = "예산은 0보다 커야 합니다"
       12 -      }
        8 +  class RouletteBudgetValidator {
        9    
       10 -      fun validate(
       11 -          budgetDate: LocalDate,
       12 -          totalBudget: Long,
       13 -      ) {
       10 +      fun createValidator(budgetDate: LocalDate, totalBudget: Long) {
       11            validateBudgetDate(budgetDate)
       12            validateBudgetAmount(totalBudget)
       13        }
       14    
       15 -      private fun validateBudgetDate(budgetDate: LocalDate) {
       16 -          if (budgetDate.isBefore(LocalDate.now())) {
       17 -              throw ValidationException(INVALID_BUDGET_DATE_MESSAGE)
       18 -          }
       19 -      }
       20 -  
       21 -      private fun validateBudgetAmount(totalBudget: Long) {
       22 -          if (totalBudget <= 0) {
       23 -              throw ValidationException(INVALID_BUDGET_AMOUNT_MESSAGE)
       24 -          }
       25 -      }
       26 -  }
       27 -  
       28 -  @Component
       29 -  class RouletteBudgetUpdateValidator {
       30 -      companion object {
       31 -          private const val INVALID_BUDGET_DATE_MESSAGE = "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다"
       32 -          private const val INVALID_BUDGET_AMOUNT_MESSAGE = "예산은 0보다 커야 합니다"
       33 -      }
       34 -  
       35 -      fun validate(
       36 -          budgetDate: LocalDate,
       37 -          totalBudget: Long,
       38 -      ) {
       15 +      fun updateValidator(budgetDate: LocalDate, totalBudget: Long) {
       16            validateBudgetDate(budgetDate)
       17            validateBudgetAmount(totalBudget)
       18        }
       19    
       20        private fun validateBudgetDate(budgetDate: LocalDate) {
       21            if (budgetDate.isBefore(LocalDate.now())) {
       22 -              throw ValidationException(INVALID_BUDGET_DATE_MESSAGE)
       22 +              throw ValidationException("현재날짜보다 이전날짜의 예산을 조정할 수 없습니다")
       23            }
       24        }
       25    
       26        private fun validateBudgetAmount(totalBudget: Long) {
       27            if (totalBudget <= 0) {
       28 -              throw ValidationException(INVALID_BUDGET_AMOUNT_MESSAGE)
       28 +              throw ValidationException("예산은 0보다 커야 합니다")
       29            }
       30        }
       31 -  }
       31 +  }
       32   \ No newline at end of file

> 메시지는 상수값으로 분리

⏺ Write(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetValidator.kt)
  ⎿  User rejected update to api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetValidator.kt
        5    import java.time.LocalDate
        6    
        7    @Component
        8 -  class RouletteBudgetCreateValidator {
        8 +  class RouletteBudgetValidator {
        9 +  
       10        companion object {
       11            private const val INVALID_BUDGET_DATE_MESSAGE = "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다"
       12            private const val INVALID_BUDGET_AMOUNT_MESSAGE = "예산은 0보다 커야 합니다"
       13        }
       14    
       15 -      fun validate(
       16 -          budgetDate: LocalDate,
       17 -          totalBudget: Long,
       18 -      ) {
       15 +      fun createValidator(budgetDate: LocalDate, totalBudget: Long) {
       16            validateBudgetDate(budgetDate)
       17            validateBudgetAmount(totalBudget)
       18        }
       19    
       20 -      private fun validateBudgetDate(budgetDate: LocalDate) {
       21 -          if (budgetDate.isBefore(LocalDate.now())) {
       22 -              throw ValidationException(INVALID_BUDGET_DATE_MESSAGE)
       23 -          }
       24 -      }
       25 -  
       26 -      private fun validateBudgetAmount(totalBudget: Long) {
       27 -          if (totalBudget <= 0) {
       28 -              throw ValidationException(INVALID_BUDGET_AMOUNT_MESSAGE)
       29 -          }
       30 -      }
       31 -  }
       32 -  
       33 -  @Component
       34 -  class RouletteBudgetUpdateValidator {
       35 -      companion object {
       36 -          private const val INVALID_BUDGET_DATE_MESSAGE = "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다"
       37 -          private const val INVALID_BUDGET_AMOUNT_MESSAGE = "예산은 0보다 커야 합니다"
       38 -      }
       39 -  
       40 -      fun validate(
       41 -          budgetDate: LocalDate,
       42 -          totalBudget: Long,
       43 -      ) {
       20 +      fun updateValidator(budgetDate: LocalDate, totalBudget: Long) {
       21            validateBudgetDate(budgetDate)
       22            validateBudgetAmount(totalBudget)
       23        }
     ...
       58                throw ValidationException(INVALID_BUDGET_AMOUNT_MESSAGE)
       59            }
       60        }
       61 -  }
       61 +  }
       62   \ No newline at end of file

> 아니 클래스가 두개로

  RouletteBudgetCreateValidator
  RouletteBudgetUpdateValidator

⏺ Write(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetValidator.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetValidator.kt with 55 additions     
        1    package org.example.roulette.api.roulette.app
        2    
        3 +  import org.example.roulette.api.common.app.ValidationException
        4 +  import org.springframework.stereotype.Component
        5 +  import java.time.LocalDate
        6 +  
        7 +  @Component
        8 +  class RouletteBudgetCreateValidator {
        9 +  
       10 +      companion object {
       11 +          private const val INVALID_BUDGET_DATE_MESSAGE = "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다"
       12 +          private const val INVALID_BUDGET_AMOUNT_MESSAGE = "예산은 0보다 커야 합니다"
       13 +      }
       14 +  
       15 +      fun validate(budgetDate: LocalDate, totalBudget: Long) {
       16 +          validateBudgetDate(budgetDate)
       17 +          validateBudgetAmount(totalBudget)
       18 +      }
       19 +  
       20 +      private fun validateBudgetDate(budgetDate: LocalDate) {
       21 +          if (budgetDate.isBefore(LocalDate.now())) {
       22 +              throw ValidationException(INVALID_BUDGET_DATE_MESSAGE)
       23 +          }
       24 +      }
       25 +  
       26 +      private fun validateBudgetAmount(totalBudget: Long) {
       27 +          if (totalBudget <= 0) {
       28 +              throw ValidationException(INVALID_BUDGET_AMOUNT_MESSAGE)
       29 +          }
       30 +      }
       31 +  }
       32 +  
       33 +  @Component
       34 +  class RouletteBudgetUpdateValidator {
       35 +  
       36 +      companion object {
       37 +          private const val INVALID_BUDGET_DATE_MESSAGE = "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다"
       38 +          private const val INVALID_BUDGET_AMOUNT_MESSAGE = "예산은 0보다 커야 합니다"
       39 +      }
       40 +  
       41 +      fun validate(budgetDate: LocalDate, totalBudget: Long) {
       42 +          validateBudgetDate(budgetDate)
       43 +          validateBudgetAmount(totalBudget)
       44 +      }
       45 +  
       46 +      private fun validateBudgetDate(budgetDate: LocalDate) {
       47 +          if (budgetDate.isBefore(LocalDate.now())) {
       48 +              throw ValidationException(INVALID_BUDGET_DATE_MESSAGE)
       49 +          }
       50 +      }
       51 +  
       52 +      private fun validateBudgetAmount(totalBudget: Long) {
       53 +          if (totalBudget <= 0) {
       54 +              throw ValidationException(INVALID_BUDGET_AMOUNT_MESSAGE)
       55 +          }
       56 +      }
       57 +  }
       58   \ No newline at end of file

⏺ 구현 완료했습니다. RouletteBudgetCreateValidator와 RouletteBudgetUpdateValidator 두 개의 클래스로 분리하여 생성했고, 검증 메시지는 상수값으로 분리했습니다.

> @api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt  @api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt 에 각각 적용해줘
  ⎿  Read api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt (60 lines)
  ⎿  Read api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt (52 lines)

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt with 1 addition
       11    @Transactional
       12    class RouletteBudgetUpdateService(
       13        private val rouletteBudgetRepository: RouletteBudgetRepository,
       14 +      private val rouletteBudgetUpdateValidator: RouletteBudgetUpdateValidator,
       15    ) {
       16        fun updateRouletteBudget(request: RouletteBudgetUpdateRequest) {
       17            validateBudgetDate(request.budgetDate)
  ⎿  Found 1 new diagnostic issue in 1 file (ctrl-r to expand)

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt with 1 addition and 2 removals
       14        private val rouletteBudgetUpdateValidator: RouletteBudgetUpdateValidator,
       15    ) {
       16        fun updateRouletteBudget(request: RouletteBudgetUpdateRequest) {
       17 -          validateBudgetDate(request.budgetDate)
       18 -          validateBudgetAmount(request.totalBudget)
       17 +          rouletteBudgetUpdateValidator.validate(request.budgetDate, request.totalBudget)
       18    
       19            val existingBudget = rouletteBudgetRepository.findByBudgetDate(request.budgetDate)
       20            requireNotNull(existingBudget) {
  ⎿  Found 2 new diagnostic issues in 1 file (ctrl-r to expand)

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt with 11 removals
       24            updateExistingBudget(existingBudget, request.totalBudget)
       25        }
       26    
       27 -      private fun validateBudgetDate(budgetDate: LocalDate) {
       28 -          require(!budgetDate.isBefore(LocalDate.now())) {
       29 -              "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다"
       30 -          }
       31 -      }
       27    
       28 -      private fun validateBudgetAmount(totalBudget: Long) {
       29 -          require(totalBudget > 0) {
       30 -              "예산은 0보다 커야 합니다"
       31 -          }
       32 -      }
       33 -  
       28        private fun updateExistingBudget(
       29            existingBudget: RouletteBudget,
       30            newTotalBudget: Long,
  ⎿  Found 1 new diagnostic issue in 1 file (ctrl-r to expand)

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Error editing file

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt with 1 removal
       4    import org.example.roulette.api.roulette.domain.RouletteBudgetRepository
       5    import org.springframework.stereotype.Service
       6    import org.springframework.transaction.annotation.Transactional
       7 -  import java.time.LocalDate
       7    import java.time.LocalDateTime
       8    
       9    @Service

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt with 1 addition
       11    @Transactional
       12    class RouletteBudgetCreateService(
       13        private val rouletteBudgetRepository: RouletteBudgetRepository,
       14 +      private val rouletteBudgetCreateValidator: RouletteBudgetCreateValidator,
       15    ) {
       16        fun createRouletteBudget(request: RouletteBudgetCreateRequest) {
       17            validateBudgetDate(request.budgetDate)

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt with 1 addition and 2 removals
       14        private val rouletteBudgetCreateValidator: RouletteBudgetCreateValidator,
       15    ) {
       16        fun createRouletteBudget(request: RouletteBudgetCreateRequest) {
       17 -          validateBudgetDate(request.budgetDate)
       18 -          validateBudgetAmount(request.totalBudget)
       17 +          rouletteBudgetCreateValidator.validate(request.budgetDate, request.totalBudget)
       18    
       19            val existingBudget = rouletteBudgetRepository.findByBudgetDate(request.budgetDate)
       20            require(existingBudget == null) {

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt with 11 removals
       24            createNewBudget(request)
       25        }
       26    
       27 -      private fun validateBudgetDate(budgetDate: LocalDate) {
       28 -          require(!budgetDate.isBefore(LocalDate.now())) {
       29 -              "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다"
       30 -          }
       31 -      }
       27    
       28 -      private fun validateBudgetAmount(totalBudget: Long) {
       29 -          require(totalBudget > 0) {
       30 -              "예산은 0보다 커야 합니다"
       31 -          }
       32 -      }
       33 -  
       28        private fun createNewBudget(request: RouletteBudgetCreateRequest) {
       29            val newBudget =
       30                RouletteBudget(
  ⎿  Found 3 new diagnostic issues in 1 file (ctrl-r to expand)

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetCreateService.kt with 1 removal
       4    import org.example.roulette.api.roulette.domain.RouletteBudgetRepository
       5    import org.springframework.stereotype.Service
       6    import org.springframework.transaction.annotation.Transactional
       7 -  import java.time.LocalDate
       7    import java.time.LocalDateTime
       8    
       9    @Service
  ⎿  Found 1 new diagnostic issue in 1 file (ctrl-r to expand)

⏺ 적용 완료했습니다. 각 서비스에서 validator를 주입받아 사용하도록 수정하고, 기존 private 검증 메서드들은 제거했습니다.

> updateExistingBudget 이 로직 roulettebudget 엔티티안에 구현해줘 copy말고 var로 열어서
  ⎿  ⧉ Selected 1 lines from api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt in IntelliJ IDEA

⏺ Read(api/src/main/kotlin/org/example/roulette/api/roulette/domain/RouletteBudget.kt)
  ⎿  Read 47 lines (ctrl+r to expand)

⏺ Read(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Read 20 lines (ctrl+r to expand)

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/domain/RouletteBudget.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/domain/RouletteBudget.kt with 1 addition and 1 removal
       21        @Column(name = "budget_date")
       22        val budgetDate: LocalDate,
       23        @Column(name = "total_budget")
       24 -      val totalBudget: Long,
       24 +      var totalBudget: Long,
       25        @Column(name = "remaining_budget")
       26        var remainingBudget: Long,
       27        @Column(name = "created_at")

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/domain/RouletteBudget.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/domain/RouletteBudget.kt with 13 additions
       43            remainingBudget += point.value
       44            updatedAt = LocalDateTime.now()
       45        }
       46 +  
       47 +      fun updateBudget(newTotalBudget: Long) {
       48 +          val usedBudget = totalBudget - remainingBudget
       49 +          val newRemainingBudget = newTotalBudget - usedBudget
       50 +  
       51 +          require(newRemainingBudget >= 0) {
       52 +              "현재 남아있는 예산(${remainingBudget}p)보다 낮게 수정할 수 없습니다"
       53 +          }
       54 +  
       55 +          totalBudget = newTotalBudget
       56 +          remainingBudget = newRemainingBudget
       57 +          updatedAt = LocalDateTime.now()
       58 +      }
       59    }

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt with 2 additions and 1 removal
       21                throw NoDataException("해당 날짜의 예산이 존재하지 않습니다")
       22            }
       23    
       24 -          updateExistingBudget(existingBudget, request.totalBudget)
       24 +          existingBudget.updateBudget(request.totalBudget)
       25 +          rouletteBudgetRepository.save(existingBudget)
       26        }
       27    
       28    

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt with 21 removals
       25            rouletteBudgetRepository.save(existingBudget)
       26        }
       27    
       28 -  
       29 -      private fun updateExistingBudget(
       30 -          existingBudget: RouletteBudget,
       31 -          newTotalBudget: Long,
       32 -      ) {
       33 -          val usedBudget = existingBudget.totalBudget - existingBudget.remainingBudget
       34 -          val newRemainingBudget = newTotalBudget - usedBudget
       35 -  
       36 -          require(newRemainingBudget >= 0) {
       37 -              "현재 남아있는 예산(${existingBudget.remainingBudget}p)보다 낮게 수정할 수 없습니다"
       38 -          }
       39 -  
       40 -          val updatedBudget =
       41 -              existingBudget.copy(
       42 -                  totalBudget = newTotalBudget,
       43 -                  remainingBudget = newRemainingBudget,
       44 -                  updatedAt = LocalDateTime.now(),
       45 -              )
       46 -  
       47 -          rouletteBudgetRepository.save(updatedBudget)
       48 -      }
       28    }

⏺ Update(api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt)
  ⎿  Updated api/src/main/kotlin/org/example/roulette/api/roulette/app/RouletteBudgetUpdateService.kt with 1 removal
        5    import org.example.roulette.api.roulette.domain.RouletteBudgetRepository
        6    import org.springframework.stereotype.Service
        7    import org.springframework.transaction.annotation.Transactional
        8 -  import java.time.LocalDateTime
        8    
        9    @Service
       10    @Transactional

⏺ 완료했습니다. RouletteBudget 엔티티에 updateBudget 메서드를 추가하고, totalBudget을 var로 변경했으며, 서비스에서는 엔티티의 메서드를 사용하도록 수정했습니다.

> 프론트쪽 이슈야
  예산관리 생성 및 수정에서 {"code":"400","message":"현재날짜보다 이전날짜의 예산을 조정할 수 없습니다","data":null}
  이렇게 코드가 400이면 alert창을 띄워야해

⏺ 프론트엔드에서 400 에러 코드를 받았을 때 alert창을 띄워야 한다는 이슈네요.

  현재 백엔드에서 ValidationException을 던지고 있어서 400 에러가 발생하는 것 같습니다. 프론트엔드 코드를 확인해서 400 에러 응답을 받았을 때 message 필드의 내용으로 alert를 띄우도록 수정하면 될 것
  같습니다.

  프론트엔드 코드 구조를 확인해볼 수 있을까요? 예산 관리 생성/수정 API 호출 부분을 보여주시면 어디서 에러 핸들링을 추가해야 할지 알 수 있을 것 같습니다.

> @ui/packages/admin-app/src/api/roulette-budget-create-admin-api 여기 주변찾아봐
  ⎿  Listed directory ui/packages/admin-app/src/api/roulette-budget-create-admin-api/

⏺ Read(ui/packages/admin-app/src/api/roulette-budget-create-admin-api/roulette-budget-create-admin-api.ts)
  ⎿  Read 107 lines (ctrl+r to expand)
  ⎿  ui/CLAUDE.md

⏺ List(ui/packages/admin-app/src/api)
  ⎿  Listed 30 paths (ctrl+r to expand)

⏺ Read(ui/packages/admin-app/src/api/axiosInstance.ts)
  ⎿  Read 62 lines (ctrl+r to expand)

⏺ Search(pattern: "**/roulette-budget*.tsx", path: "ui/packages/admin-app")
  ⎿  Found 0 files 

⏺ Search(pattern: "**/*budget*.tsx", path: "ui/packages/admin-app")
  ⎿  Found 1 file (ctrl+r to expand)

> 아니면 axios 공통으로 설정해도됨

⏺ 맞습니다! axios 인터셉터에서 공통으로 처리하는게 더 효율적이네요.

⏺ Read(ui/packages/admin-app/src/components/BudgetManagement.tsx)
  ⎿  Read 252 lines (ctrl+r to expand)

⏺ 네, axiosInstance에서 400 에러에 대한 공통 처리를 추가하는 것이 좋은 방법입니다.

  현재 상황을 정리하면:
  1. 백엔드에서 ValidationException을 던져서 400 에러 응답이 옴
  2. 응답 형태: {"code":"400","message":"현재날짜보다 이전날짜의 예산을 조정할 수 없습니다","data":null}
  3. 프론트엔드에서 400 에러 시 message를 alert로 표시해야 함

  현재 axiosInstance.ts를 보면 네트워크 에러만 처리하고 있는데, 400 에러에 대한 처리를 추가하면 됩니다.
  ⎿  User rejected Claude's plan:
     ╭──────────────────────────────────────────────────────────────────╮
     │ 400 에러 Alert 처리 계획                                         │
     │                                                                  │
     │ 수정할 파일: /ui/packages/admin-app/src/api/axiosInstance.ts     │
     │                                                                  │
     │ 변경 내용:                                                       │
     │ 1. response interceptor의 error 핸들링 부분에 400 에러 처리 추가 │
     │ 2. 400 에러 응답에서 message 필드를 추출하여 alert로 표시        │
     │ 3. 기존 네트워크 에러 처리는 유지                                │
     │                                                                  │
     │ 구체적 수정사항:                                                 │
     │ - error.response.status === 400인 경우 체크                      │
     │ - error.response.data.message를 alert로 표시                     │
     │ - 예산 생성/수정뿐만 아니라 모든 400 에러에 대해 공통 처리       │
     ╰──────────────────────────────────────────────────────────────────╯

> 아니야 실제 400 httpstatuscode는 아니야 response.data에 code 필드로 제어해

⏺ 아, 이해했습니다! HTTP 상태코드는 200이지만, 응답 데이터의 code 필드가 "400"인 경우를 처리해야 하는거네요.

  현재 응답 구조:
  {
    "code": "400",
    "message": "현재날짜보다 이전날짜의 예산을 조정할 수 없습니다",
    "data": null
  }

  이 경우 HTTP 상태코드는 200 성공이지만, 응답 데이터의 code 필드를 확인해서 "400"이면 message를 alert로 띄워야 합니다.

  수정 계획

  수정할 파일: /ui/packages/admin-app/src/api/axiosInstance.ts

  변경 내용:
  1. response interceptor의 성공 응답(200) 부분에서 response.data.code 체크
  2. response.data.code === "400"인 경우 response.data.message를 alert로 표시
  3. 그 후 에러로 reject 처리하여 mutation의 onError가 호출되도록 함

  구체적 수정사항:
  - response.data.code가 "400"인지 확인
  - alert로 response.data.message 표시
  - Promise.reject()로 에러 처리하여 mutation 실패로 인식되도록 함

  이렇게 하면 예산 생성/수정 시 ValidationException이 발생해도 적절히 사용자에게 메시지가 표시됩니다.

> 진행해
                                                                                      
⏺ User approved Claude's plan:
  ⎿  응답 데이터 code 필드 기반 400 에러 처리

     수정할 파일: /ui/packages/admin-app/src/api/axiosInstance.ts

     변경 내용:
     1. response interceptor의 성공 응답 부분에서 response.data.code 확인
     2. response.data.code === "400"인 경우 response.data.message를 alert로 표시
     3. 에러로 reject 처리하여 mutation의 에러 핸들링이 작동하도록 함

     수정 위치: 
     - axiosClient.interceptors.response.use() 첫 번째 콜백 함수 (성공 응답 처리 부분)
     - return response; 전에 code 체크 로직 추가

⏺ Update(ui/packages/admin-app/src/api/axiosInstance.ts)
  ⎿  Updated ui/packages/admin-app/src/api/axiosInstance.ts with 5 additions
       14    // Response interceptor for handling errors
       15    axiosClient.interceptors.response.use(
       16      response => {
       17 +      // Check for application-level error codes in response data
       18 +      if (response.data && response.data.code === "400") {
       19 +        alert(response.data.message);
       20 +        return Promise.reject(new Error(response.data.message));
       21 +      }
       22        return response;
       23      },
       24      error => {

⏺ 완료했습니다. 이제 응답 데이터의 code 필드가 "400"인 경우 message 내용으로 alert가 표시되고, mutation이 에러로 처리됩니다.

> @agent-git-commit-assistant staged된거 커밋 해줘

⏺ git-commit-assistant(Commit staged changes)
  ⎿  Done (2 tool uses · 19.1k tokens · 19.1s)                                                                                                                                                            

⏺ y

⏺ git-commit-assistant(Proceed with commit)
  ⎿  Done (3 tool uses · 14.7k tokens · 52.1s)                                                                                                                                                            

```