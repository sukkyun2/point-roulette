# [사용자] 상품 주문

```sql
╭───────────────────────────────────────────────────╮
│ ✻ Welcome to Claude Code!                         │
│                                                   │
│   /help for help, /status for your current setup  │
│                                                   │
│   cwd: /Users/goobg/Desktop/point-roulette        │
╰───────────────────────────────────────────────────╯

> https://github.com/sukkyun2/point-roulette/issues/13 상품주문 프론트엔드를 구현할거야
  일단 상품 리스트 조회 페이지에서 구매 버튼을 만들고 만약 사용자가 들고있는 금액보다 부족하다면 disable처리해

⏺ 상품주문 프론트엔드를 구현하겠습니다. GitHub 이슈를 확인하고 상품 리스트 조회 페이지에 구매 버튼을 추가하겠습니다.

⏺ Bash(gh issue view 13)
  ⎿  title:	feat: [user] 상품 주문 기능 구현
     state:	OPEN
     author:	sukkyun2
     … +25 lines (ctrl+r to expand)

⏺ Search(pattern: "**/*product*")
  ⎿  Found 29 files (ctrl+r to expand)

⏺ Search(pattern: "**/*상품*")
  ⎿  Found 0 files 

⏺ Search(pattern: "product|상품", type: "tsx")
  ⎿  Found 0 files 

⏺ Read(ui/packages/user-app/src/pages/ProductListPage.tsx)
  ⎿  Read 10 lines (ctrl+r to expand)

⏺ Read(ui/packages/user-app/src/components/ProductList.tsx)
  ⎿  Read 100 lines (ctrl+r to expand)

⏺ Search(pattern: "order|주문", type: "kt")
  ⎿  Found 0 files 

⏺ List(api/src/main/kotlin/org/example/roulette/api/order)
  ⎿  Listed 13 paths (ctrl+r to expand)

⏺ Read(api/src/main/kotlin/org/example/roulette/api/order/api/OrderApi.kt)
  ⎿  Read 23 lines (ctrl+r to expand)

⏺ Search(pattern: "**/order*")
  ⎿  Found 7 files (ctrl+r to expand)
  ⎿  api/CLAUDE.md

⏺ Read(ui/packages/user-app/src/api/order-api/order-api.ts)
  ⎿  Read 104 lines (ctrl+r to expand)

⏺ Update(ui/packages/user-app/src/components/ProductList.tsx)
  ⎿  Updated ui/packages/user-app/src/components/ProductList.tsx with 1 addition                  
       2    import { useGetProducts } from '../api/product-list-query-api/product-list-query-api';
       3    import { ProductListQueryResponse } from '../api/models';
       4    import { useAuth } from '../contexts/AuthContext';
       5 +  import { useCreateOrder } from '../api/order-api/order-api';
       6    
       7    interface ProductItemProps {
       8      product: ProductListQueryResponse;

⏺ Update(ui/packages/user-app/src/components/ProductList.tsx)
  ⎿  Updated ui/packages/user-app/src/components/ProductList.tsx with 2 additions           
        7    interface ProductItemProps {
        8      product: ProductListQueryResponse;
        9      userBalance: number;
       10 +    onPurchase: (productId: string) => void;
       11 +    isPurchasing: boolean;
       12    }
       13    
       14    const ProductItem: React.FC<ProductItemProps> = ({ product, userBalance }) => {

⏺ Update(ui/packages/user-app/src/components/ProductList.tsx)
  ⎿  Updated ui/packages/user-app/src/components/ProductList.tsx with 37 additions and 13 removals
       11      isPurchasing: boolean;
       12    }
       13    
       14 -  const ProductItem: React.FC<ProductItemProps> = ({ product, userBalance }) => {
       15 -    const canPurchase = userBalance >= (product.price || 0);
       14 +  const ProductItem: React.FC<ProductItemProps> = ({ 
       15 +    product, 
       16 +    userBalance, 
       17 +    onPurchase, 
       18 +    isPurchasing 
       19 +  }) => {
       20 +    const canPurchase = userBalance >= (product.price || 0) && userBalance > 0;
       21    
       22 +    const handlePurchase = () => {
       23 +      if (canPurchase && product.id) {
       24 +        onPurchase(product.id);
       25 +      }
       26 +    };
       27 +  
       28      return (
       29        <div className="border border-gray-200 rounded-lg p-4 shadow-sm">
       30          <h3 className="text-lg font-semibold text-gray-800 mb-2">
       31            {product.name}
       32          </h3>
       33 -        <div className="flex justify-between items-center">
       34 -          <span className="text-xl font-bold text-blue-600">
       35 -            {product.price?.toLocaleString()}원
       36 -          </span>
       37 -          <span
       38 -            className={`px-2 py-1 rounded text-sm ${
       39 -              canPurchase
       40 -                ? 'bg-green-100 text-green-800'
       41 -                : 'bg-red-100 text-red-800'
       33 +        <div className="space-y-3">
       34 +          <div className="flex justify-between items-center">
       35 +            <span className="text-xl font-bold text-blue-600">
       36 +              {product.price?.toLocaleString()}원
       37 +            </span>
       38 +            <span
       39 +              className={`px-2 py-1 rounded text-sm ${
       40 +                canPurchase
       41 +                  ? 'bg-green-100 text-green-800'
       42 +                  : 'bg-red-100 text-red-800'
       43 +              }`}
       44 +            >
       45 +              {canPurchase ? '구매 가능' : userBalance < 0 ? '음수 잔액' : '잔액 부족'}
       46 +            </span>
       47 +          </div>
       48 +          <button
       49 +            onClick={handlePurchase}
       50 +            disabled={!canPurchase || isPurchasing}
       51 +            className={`w-full py-2 px-4 rounded font-medium transition-colors ${
       52 +              canPurchase && !isPurchasing
       53 +                ? 'bg-blue-600 text-white hover:bg-blue-700'
       54 +                : 'bg-gray-300 text-gray-500 cursor-not-allowed'
       55              }`}
       56            >
       57 -            {canPurchase ? '구매 가능' : '잔액 부족'}
       58 -          </span>
       57 +            {isPurchasing ? '주문 중...' : canPurchase ? '구매하기' : '구매 불가'}
       58 +          </button>
       59          </div>
       60        </div>
       61      );

⏺ Update(ui/packages/user-app/src/components/ProductList.tsx)
  ⎿  Updated ui/packages/user-app/src/components/ProductList.tsx with 11 additions
       64    export const ProductList: React.FC = () => {
       65      const { user } = useAuth();
       66      const { data, isLoading, error } = useGetProducts();
       67 +    const createOrderMutation = useCreateOrder();
       68    
       69 +    const handlePurchase = async (productId: string) => {
       70 +      try {
       71 +        await createOrderMutation.mutateAsync({ data: { productId } });
       72 +        alert('주문이 완료되었습니다!');
       73 +      } catch (error) {
       74 +        console.error('주문 실패:', error);
       75 +        alert('주문에 실패했습니다. 다시 시도해주세요.');
       76 +      }
       77 +    };
       78 +  
       79      if (isLoading) {
       80        return (
       81          <div className="flex justify-center items-center py-8">

⏺ Update(ui/packages/user-app/src/components/ProductList.tsx)
  ⎿  Updated ui/packages/user-app/src/components/ProductList.tsx with 2 additions
       129                  key={product.id}
       130                  product={product}
       131                  userBalance={userBalance}
       132 +                onPurchase={handlePurchase}
       133 +                isPurchasing={createOrderMutation.isPending}
       134                />
       135              ))}
       136            </div>

⏺ 상품주문 프론트엔드 구현이 완료되었습니다.

  주요 구현 사항:
  - ProductItem 컴포넌트에 구매 버튼 추가
  - 사용자 잔액 부족 시 버튼 disable 처리
  - 음수 잔액일 때도 구매 불가 처리
  - 주문 API 연동 및 로딩 상태 처리
  - 주문 성공/실패 알림 메시지

  구현된 기능:
  1. 구매 버튼: 각 상품에 "구매하기" 버튼 추가
  2. 잔액 검증: userBalance >= product.price && userBalance > 0 조건으로 구매 가능 여부 판단
  3. 버튼 상태: 잔액 부족/음수 잔액 시 "구매 불가" 표시 및 disable 처리
  4. 로딩 처리: 주문 진행 중 "주문 중..." 표시
  5. 상태 표시: "구매 가능", "잔액 부족", "음수 잔액" 상태 구분 표시

> 로딩처리를 주문중..으로 말고 스패너로 처리해줘

⏺ Update(ui/packages/user-app/src/components/ProductList.tsx)
  ⎿  Updated ui/packages/user-app/src/components/ProductList.tsx with 27 additions and 2 removals                                               
       48            <button
       49              onClick={handlePurchase}
       50              disabled={!canPurchase || isPurchasing}
       51 -            className={`w-full py-2 px-4 rounded font-medium transition-colors ${
       51 +            className={`w-full py-2 px-4 rounded font-medium transition-colors flex items-center justify-center ${
       52                canPurchase && !isPurchasing
       53                  ? 'bg-blue-600 text-white hover:bg-blue-700'
       54                  : 'bg-gray-300 text-gray-500 cursor-not-allowed'
       55              }`}
       56            >
       57 -            {isPurchasing ? '주문 중...' : canPurchase ? '구매하기' : '구매 불가'}
       57 +            {isPurchasing ? (
       58 +              <svg
       59 +                className="animate-spin h-5 w-5 text-white"
       60 +                xmlns="http://www.w3.org/2000/svg"
       61 +                fill="none"
       62 +                viewBox="0 0 24 24"
       63 +              >
       64 +                <circle
       65 +                  className="opacity-25"
       66 +                  cx="12"
       67 +                  cy="12"
       68 +                  r="10"
       69 +                  stroke="currentColor"
       70 +                  strokeWidth="4"
       71 +                ></circle>
       72 +                <path
       73 +                  className="opacity-75"
       74 +                  fill="currentColor"
       75 +                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
       76 +                ></path>
       77 +              </svg>
       78 +            ) : canPurchase ? (
       79 +              '구매하기'
       80 +            ) : (
       81 +              '구매 불가'
       82 +            )}
       83            </button>
       84          </div>
       85        </div>

⏺ 로딩 처리를 스피너로 변경했습니다. 주문 진행 중일 때 회전하는 스피너 아이콘이 표시됩니다.

> 버튼안에서 말고 전체 페이지에 스패너를 걸수있을까?

⏺ Update(ui/packages/user-app/src/components/ProductList.tsx)
  ⎿  Updated ui/packages/user-app/src/components/ProductList.tsx with 2 additions and 27 removals                                               
       48            <button
       49              onClick={handlePurchase}
       50              disabled={!canPurchase || isPurchasing}
       51 -            className={`w-full py-2 px-4 rounded font-medium transition-colors flex items-center justify-center ${
       51 +            className={`w-full py-2 px-4 rounded font-medium transition-colors ${
       52                canPurchase && !isPurchasing
       53                  ? 'bg-blue-600 text-white hover:bg-blue-700'
       54                  : 'bg-gray-300 text-gray-500 cursor-not-allowed'
       55              }`}
       56            >
       57 -            {isPurchasing ? (
       58 -              <svg
       59 -                className="animate-spin h-5 w-5 text-white"
       60 -                xmlns="http://www.w3.org/2000/svg"
       61 -                fill="none"
       62 -                viewBox="0 0 24 24"
       63 -              >
       64 -                <circle
       65 -                  className="opacity-25"
       66 -                  cx="12"
       67 -                  cy="12"
       68 -                  r="10"
       69 -                  stroke="currentColor"
       70 -                  strokeWidth="4"
       71 -                ></circle>
       72 -                <path
       73 -                  className="opacity-75"
       74 -                  fill="currentColor"
       75 -                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
       76 -                ></path>
       77 -              </svg>
       78 -            ) : canPurchase ? (
       79 -              '구매하기'
       80 -            ) : (
       81 -              '구매 불가'
       82 -            )}
       57 +            {canPurchase ? '구매하기' : '구매 불가'}
       58            </button>
       59          </div>
       60        </div>

⏺ Update(ui/packages/user-app/src/components/ProductList.tsx)
  ⎿  Updated ui/packages/user-app/src/components/ProductList.tsx with 29 additions and 1 removal                                                 
       107      const userBalance = user?.userBalance || 0;
       108    
       109      return (
       110 -      <div className="max-w-4xl mx-auto p-6">
       110 +      <div className="relative max-w-4xl mx-auto p-6">
       111 +        {createOrderMutation.isPending && (
       112 +          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
       113 +            <div className="bg-white p-6 rounded-lg shadow-lg flex items-center space-x-3">
       114 +              <svg
       115 +                className="animate-spin h-8 w-8 text-blue-600"
       116 +                xmlns="http://www.w3.org/2000/svg"
       117 +                fill="none"
       118 +                viewBox="0 0 24 24"
       119 +              >
       120 +                <circle
       121 +                  className="opacity-25"
       122 +                  cx="12"
       123 +                  cy="12"
       124 +                  r="10"
       125 +                  stroke="currentColor"
       126 +                  strokeWidth="4"
       127 +                ></circle>
       128 +                <path
       129 +                  className="opacity-75"
       130 +                  fill="currentColor"
       131 +                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
       132 +                ></path>
       133 +              </svg>
       134 +              <span className="text-lg font-medium text-gray-700">주문 처리 중...</span>
       135 +            </div>
       136 +          </div>
       137 +        )}
       138 +        
       139          <div className="mb-6">
       140            <h1 className="text-2xl font-bold text-gray-800 mb-2">상품 목록</h1>
       141            <div className="text-gray-600">

⏺ 전체 페이지에 스피너 오버레이를 추가했습니다.

  주문 처리 중일 때:
  - 전체 화면을 어둡게 처리하는 오버레이
  - 중앙에 스피너와 "주문 처리 중..." 메시지가 포함된 흰색 모달
  - z-50으로 최상위 레이어에 표시
  - 주문 완료되면 자동으로 사라짐

```